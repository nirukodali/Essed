<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:insert="header">
	<div th:insert="header"></div>
    <div th:insert="headerImage"></div>
    <div th:insert="navBarTop"></div>
    <div th:insert="headerMessage"></div>

    <meta charset="UTF-8">
    <title>District Wise Status Report for all Crops</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Your custom styles -->
<!--    <link rel="stylesheet" type="text/css" href="css/style.css">-->

    <!-- Bootstrap and related scripts -->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">-->

    <!-- AJAX/jQuery -->
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>-->
<!--    <script src="/js/jquery-3.6.0.min.js"></script>-->


</head>

<body>
	
    <!-- Form section to select crop year -->
    <form name="form1" method="post">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-auto">
                    <div class="card card-body" style="background-color: #e6e2d3;">
                        <div class="card-title">
                            <h4 style="background-color: darkgreen; color: white; width: auto; text-align: center; padding: 7px; border: none; border-radius: 5px;">
                                District wise status report for all crops
                            </h4>
                            <br />
                        </div>

                        <!-- Table to select crop year -->
                        <table align="center">
                            <tr>
                                <th colspan="2" class="heading"><b> </b></th>
                            </tr>
                            <tr>
                                <td class="tdnum" colspan="2" style="width: 50%"><b>Crop Year <font color="red">*</font> :</b></td>
                                <td>
                                    <select name="cropyearname" id="cropyearid" style="width: 200px">
                                        <option value="0">------Select CropYear--------</option>
                                        <option th:each="cropyear : ${cropyears}" th:value="${cropyear.seasonvalue}" th:text="${cropyear.cropyear}"></option>
                                    </select>
                                </td>
                            </tr>
                           
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div align="center" id="divPrint" style="margin: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    
        <div style="width: 100%; overflow-x: auto;">
            <table id="customers" style="border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; color: #333;">
				
                <thead >
					<tr> <td  colspan="23" align="left"><b>Report Time : <span th:text="${theDate}"></span></b></td></tr>
					
                    <tr style="background-color: #04AA6D; color: #000000; text-align: center; font-weight: bold;">
                        <th align="center" rowspan="2" style="border: 1px solid #000000; padding: 8px;background: #AADD77">S.No.</th>
                        <th align="center" rowspan="2" style="border: 1px solid #000000; padding: 8px;background: #AADD77">District</th>
                        <th align="center" rowspan="2" style="border: 1px solid #000000; padding: 8px;background: #AADD77">Total Mandals</th>
                        <th align="center" rowspan="2" style="border: 1px solid #000000; padding: 8px;background: #AADD77">Total Revenue<br>Villages</th>
                        <th align="center" colspan="4" style="border: 1px solid #000000; padding: 8px; background-color: #028a0f; color: #000000">Agriculture</th>
                        <th align="center" colspan="4" style="border: 1px solid #000000; padding: 8px; background-color: #6f9d4e; color: #000000">Horticulture</th>
                        <th align="center" colspan="4" style="border: 1px solid #000000; padding: 8px; background-color: #9dbb70; color: #000000">Sericulture</th>
                        <th align="center" colspan="4" style="border: 1px solid #000000; padding: 8px; background-color: #c1d6a8; color: #000000">Social Forestry</th>
                        <th align="center" colspan="2" style="border: 1px solid #000000; padding: 8px; background-color: #b8e2b0; color: #000000">Total</th>
                    </tr>
                    <tr style="background-color: #04AA6D; color: #fff; text-align: center; font-weight: bold;">
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #028a0f;">Total Mandals<br>Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #028a0f;">Total Revenue<br>Villages Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #028a0f;">Extent<br>Booked (In Acres)</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #028a0f;">No. of<br>Farmers</th>
                        <th style="border: 1px solid #000000; padding: 8px; background-color: #6f9d4e;">Total Mandals<br>Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px; background-color: #6f9d4e;">Total Revenue<br>Villages Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #6f9d4e;">Extent<br>Booked (In Acres)</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #6f9d4e;">No. of<br>Farmers</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #9dbb70;">Total Mandals<br>Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #9dbb70;">Total Revenue<br>Villages Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #9dbb70;">Extent<br>Booked (In Acres)</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #9dbb70;">No. of<br>Farmers</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #c1d6a8;">Total Mandals<br>Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #c1d6a8;">Total Revenue<br>Villages Covered</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #c1d6a8;">Extent<br>Booked (In Acres)</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #c1d6a8;">No. of<br>Farmers</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #b8e2b0;">Extent<br>Booked (In Acres)</th>
                        <th style="border: 1px solid #000000; padding: 8px;background-color: #b8e2b0;">No. of<br>Farmers</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table body rows will be populated dynamically -->
                </tbody>
            </table>
        
    </div>
</div>




        <!-- Buttons section for different crops and export options -->
        <div align="center" style="color: black; margin-top: 10px;">
            <form method="GET">
                <b>Crops Covered:</b> 
                <input name="agri" type="submit" value="Agriculture" formaction="./Rep_Agri_Crops" class="btn btn-success">
                <input name="agri" type="submit" value="Horticulture" formaction="./Rep_Horti_Crops" class="btn btn-success">
                <input name="agri" type="submit" value="Sericulture" formaction="./Rep_Seri_Crops" class="btn btn-success">
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" id="ctl00_ContentPlaceHolder1_btnPrint" onClick="CallPrint('divPrint')" value="Print" class="btn btn-success">
                <input type="button" onclick="tableToExcel('customers', 'DistrictWiseReport')" value="Excel" class="btn btn-success">
                <input type="button" value="Back" onclick="goBack()" class="btn btn-success">
            </form>
        </div>

    <!-- Custom JavaScript for AJAX and other functionality -->
   <script>
    $(document).ready(function() {
        $('#cropyearid').on('change', function() {
            const cropYearId = $(this).val(); // Event Listener for Dropdown Change
            const url = `./districtwisestatusreportforallcrp/${cropYearId}`; // Constructing the URL

            $.ajax({
                url: url,
                type: 'GET',
                success: function(response) {
                    $('#customers tbody').empty(); // Clear existing table rows
                    $('#message').hide();

                    if (response.message) { // Check if there's a message
                        $('#message').text(response.message).show();
                    }

                    if (response.data && response.data.length > 0) {
                        const tableData = response.data;
                        const totals = {
                            totalTmandals: 0,
                            totalVillages: 0,
                            totalAgriMandals: 0,
                            totalAgriVillages: 0,
                            totalAgriExt: 0.0,
                            totalAgriFarmers: 0,
                            totalHortiMandals: 0,
                            totalHortiVillages: 0,
                            totalHortiExt: 0.0,
                            totalHortiFarmers: 0,
                            totalSeriMandals: 0,
                            totalSeriVillages: 0,
                            totalSeriExt: 0.0,
                            totalSeriFarmers: 0,
                            totalSocMandals: 0,
                            totalSocVillages: 0,
                            totalSocExt: 0.0,
                            totalSocFarmers: 0,
                            totalExtentBooked: 0.0,
                            totalFarmers: 0
                        };

                        tableData.forEach((rowData, i) => {
                            const agriExt = parseFloat(rowData.dagri_ext) || 0.0;
                            const hortiExt = parseFloat(rowData.dhorti_ext) || 0.0;
                            const seriExt = parseFloat(rowData.dseri_ext) || 0.0;
                            const socExt = parseFloat(rowData.dsoc_ext) || 0.0;

                            const agriFarmers = parseInt(rowData.dagri_farmers) || 0;
                            const hortiFarmers = parseInt(rowData.dhorti_farmers) || 0;
                            const seriFarmers = parseInt(rowData.dseri_farmers) || 0;
                            const socFarmers = parseInt(rowData.dsoc_farmers) || 0;

                            totals.totalTmandals += Number(rowData.tmandals) || 0;
                            totals.totalVillages += Number(rowData.tvillages) || 0;
                            totals.totalAgriMandals += parseInt(rowData.dagri_mandals) || 0;
                            totals.totalAgriVillages += parseInt(rowData.dagri_villages) || 0;
                            totals.totalAgriExt += agriExt;
                            totals.totalAgriFarmers += agriFarmers;

                            totals.totalHortiMandals += parseInt(rowData.dhorti_mandals) || 0;
                            totals.totalHortiVillages += parseInt(rowData.dhorti_villages) || 0;
                            totals.totalHortiExt += hortiExt;
                            totals.totalHortiFarmers += hortiFarmers;

                            totals.totalSeriMandals += parseInt(rowData.dseri_mandals) || 0;
                            totals.totalSeriVillages += parseInt(rowData.dseri_villages) || 0;
                            totals.totalSeriExt += seriExt;
                            totals.totalSeriFarmers += seriFarmers;

                            totals.totalSocMandals += parseInt(rowData.dsoc_mandals) || 0;
                            totals.totalSocVillages += parseInt(rowData.dsoc_villages) || 0;
                            totals.totalSocExt += socExt;
                            totals.totalSocFarmers += socFarmers;

                            totals.totalExtentBooked += agriExt + hortiExt + seriExt + socExt;
                            totals.totalFarmers += agriFarmers + hortiFarmers + seriFarmers + socFarmers;

                            $('#customers tbody').append(
                                `<tr>
                                    <td align='right' style="border:1px solid black; padding:7px;background: #AADD77;">${i + 1}</td>
                                    <td align='left' style="border:1px solid black; padding:7px;background: #AADD77;">${rowData.wbdname}</td>
                                    <td align='right' style="border:1px solid black; padding:7px;background: #AADD77;">${rowData.tmandals}</td>
                                    <td align='right' style="border:1px solid black; padding:7px;background: #AADD77;">${rowData.tvillages}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dagri_mandals}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dagri_villages}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${agriExt.toFixed(2)}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${agriFarmers}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dhorti_mandals}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dhorti_villages}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${hortiExt.toFixed(2)}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${hortiFarmers}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dseri_mandals}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dseri_villages}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${seriExt.toFixed(2)}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${seriFarmers}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dsoc_mandals}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${rowData.dsoc_villages}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${socExt.toFixed(2)}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${socFarmers}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${(agriExt + hortiExt + seriExt + socExt).toFixed(2)}</td>
                                    <td align='right' style="border:1px solid black; padding:7px">${(agriFarmers + hortiFarmers + seriFarmers + socFarmers)}</td>
                                </tr>`
                            );
                        });
     
                        $('#customers tbody').append(
                            `<tr>
                                <td colspan="2" align="center" style="background-color:#AADD77"><b>Total:</b></td>
                                <td align='center' style="background-color:#AADD77">${totals.totalTmandals}</td>
                                <td align='center' style="background-color:#AADD77">${totals.totalVillages}</td>
                                <td align='center' style="background-color: #028a0f;">${totals.totalAgriMandals}</td>
                                <td align='center' style="background-color: #028a0f;">${totals.totalAgriVillages}</td>
                                <td align='center' style="background-color: #028a0f;">${totals.totalAgriExt.toFixed(2)}</td>
                                <td align='center' style="background-color: #028a0f;">${totals.totalAgriFarmers}</td>
                                <td align='center' style="background-color: #6f9d4e;">${totals.totalHortiMandals}</td>
                                <td align='center' style="background-color: #6f9d4e;">${totals.totalHortiVillages}</td>
                                <td align='center' style="background-color: #6f9d4e;">${totals.totalHortiExt.toFixed(2)}</td>
                                <td align='center' style="background-color: #6f9d4e;">${totals.totalHortiFarmers}</td>
                                <td align='center' style="background-color: #9dbb70;">${totals.totalSeriMandals}</td>
                                <td align='center' style="background-color: #9dbb70;">${totals.totalSeriVillages}</td>
                                <td align='center' style="background-color: #9dbb70;">${totals.totalSeriExt.toFixed(2)}</td>
                                <td align='center' style="background-color: #9dbb70;">${totals.totalSeriFarmers}</td>
                                <td align='center' style="background-color: #c1d6a8;">${totals.totalSocMandals}</td>
                                <td align='center' style="background-color: #c1d6a8;">${totals.totalSocVillages}</td>
                                <td align='center' style="background-color: #c1d6a8;">${totals.totalSocExt.toFixed(2)}</td>
                                <td align='center' style="background-color: #c1d6a8;">${totals.totalSocFarmers}</td>
                                <td align='center' style="background-color: #b8e2b0;">${totals.totalExtentBooked.toFixed(2)}</td>
                                <td align='center' style="background-color: #b8e2b0;">${totals.totalFarmers}</td>
                            </tr>`
                        );
                    } else {
                        $('#customers tbody').append('<tr><td colspan="20" align="center">No Data Available</td></tr>');
                    }
                },
                error: function() {
                    $('#message').text('An error occurred while processing your request.').show();
                }
            });
        });
    });

    // Function to handle print
    function CallPrint(divId) {
        var printWindow = window.open('', '', 'height=600,width=800');
        printWindow.document.write('<html><head><title>Print</title>');
        printWindow.document.write('</head><body >');
        printWindow.document.write(document.getElementById(divId).innerHTML);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
    }

    // Function to handle export to Excel
    function tableToExcel(tableId, filename) {
        var wb = XLSX.utils.table_to_book(document.getElementById(tableId), { sheet: "Sheet1" });
        XLSX.writeFile(wb, filename + ".xlsx");
    }

    // Function to go back
    function goBack() {
        window.history.back();
    }
</script>

    <!-- Excel export library -->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>-->
</body>
<style>
	 thead{
		   position: sticky;
		   top: 0%;
	   } 
  #customers tr:nth-child(even){background-color: aliceblue;}
        #customers tr:hover {background-color: skyblue;}
        #customers th {
            padding-top: 12px;
            padding-bottom: 12px;
            font-size:15px;
        }
       
      

</style>
</html>
