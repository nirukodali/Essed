<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="header">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aadhar Updation</title>

</head>

<body>
	<div th:insert="headerImage"></div>

	<div th:insert="navBarTop"></div>
	<div th:insert="headerMessage"></div>

	<br>
	<form id="updationForm" th:action="@{./wrongaadhaarRBK}" method="get"
		onsubmit="return validateForm()" style="max-width: max-content;">
		<div
			style="background-color: green; margin-left: auto; margin-right: auto; width: 100%; text-align: center; font-size: 200%; color: white;" th:if="${code == 'cc'}">
			CCRC Wrong Seeded Aadhaar Correction</div>
		<div
			style="background-color: green; margin-left: auto; margin-right: auto; width: 100%; text-align: center; font-size: 200%; color: white;" th:if="${code == 'rc'}">
			<span th:if="${cType == 'R'}">ROFR </span> 
			<span th:if="${cType == 'K'}">Cultivaltor </span> 
			<span th:if="${cType == 'L'}">Enjoyer </span> 
			<span th:if="${cType == 'O'}">Owner </span> 
			Wrong Name & Aadhaar Correction</div>

		<div class="table-wrapper" style="margin: 20px; margin-right: 0;max-width: 100%;overflow-x: scroll;overflow-y: auto;" >
			<div
				style="background-color: ghostwhite;margin-bottom: 20px;">
				<table id="myTable"
					style="border: 1px solid black; border-collapse: separate; border-spacing: 0px; width: 100%;">
					<thead style="background-color: darkgray; color: white;">
						<tr>
							<th style="padding: 5px; text-align: left; padding-left: 30px; width: 1%;"><input
								id="main" type="checkbox"></th>
							<th style="padding: 5px; text-align: center; width: 1%;">SNO</th>
							<th style="padding: 5px; text-align: center; width: 15%;">BookingId</th>
							<th style="padding: 5px; text-align: center; width: 15%;"  th:if="${code == 'cc'}">CCRC Name</th>
							<th style="padding: 10px; text-align: center; width: 15%;"  th:if="${code == 'cc'}">CCRC Father Name</th>
							<th style="padding: 5px; text-align: center; width: 15%;"  th:if="${cType == 'R'}">ROFR Name</th>
							<th style="padding: 10px; text-align: center; width: 15%;"  th:if="${cType == 'R'}">ROFR Father Name</th>
							<th style="padding: 5px; text-align: center; width: 15%;"  th:if="${cType == 'K'}">Cultivator Name</th>
							<th style="padding: 10px; text-align: center; width: 15%;"  th:if="${cType == 'K'}">Cultivator Father Name</th>
							<th style="padding: 5px; text-align: center; width: 15%;"  th:if="${cType == 'L'}">Enjoyer Name</th>
							<th style="padding: 10px; text-align: center; width: 15%;"  th:if="${cType == 'L'}">Enjoyer Father Name</th>
							<th style="padding: 5px; text-align: center; width: 15%;"  th:if="${cType == 'O'}">Owner Name</th>
							<th style="padding: 10px; text-align: center; width: 15%;"  th:if="${cType == 'O'}">Owner Father Name</th>
							<th style="padding: 10px; text-align: center; width: 10%;">Survey No</th>
							<th style="padding: 10px; text-align: center; width: 8%;">Khata No</th>
							<th style="padding: 10px; text-align: center; width: 10%;">Aadhaar as per WebLand </th>
							<th style="padding: 10px; text-align: center; width: 10%;">Correct Aadhaar no to be updated</th>
								<th style="padding: 10px; text-align: center; width: 15%;">Correct Name to be updated</th>
								<th style="padding: 10px; text-align: center; width: 15%;">Correct Father Name to be updated</th>

						</tr>

					</thead>
					<tbody>


						<tr th:each="item : ${list}">


							<td><input type="checkbox" class="sub-checkbox"
								style="margin-left: 42%; padding: 5px;"></td>
							<td style="padding: 5px; text-align: center;"
								th:text="${itemStat.index + 1}"></td>
				<td><input name="Bookingid" id="Bookingid"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								th:value="${item.getBookingid}" disabled></td>		
								
							<td><input name="ocName" id="ocName"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								th:value="${item.getOc_name()}" disabled></td>
								<input type="hidden" th:value="${code}" th:id="codee" th:name="codee">
								<input type="hidden" th:value="${cType}" th:id="cType" th:name="cType">
									
							<td><input name="ocfName" id="ocfName"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								th:value="${item.getOc_fname()}" disabled></td>
								
									
							<td><input name="sNo"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								th:value="${item.getCr_sno()}" disabled></td>
							<td><input name="khNo"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								th:value="${item.getKh_no()}" disabled></td>
								<td><input 	style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								 name="oldaadhaar" id="oldaadhaar"  th:value="${item.getCr_farmeruid}" readonly disabled></td>
								
							<td><input class="input-field" name="aadhaar" id="aadhaar"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								maxlength="12" onkeypress="return ( event.charCode == 8 || event.charCode == 0) || event.charCode == 46 ? null : event.charCode >= 48 && event.charCode <= 57 "
								title="please enter 12 digit Aadhaar number" disabled required></td>
							<!---->
							
							<td><input  class="input-field" name="newocName" id="newocName"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								 pattern="[A-Za-z\s]+" title="Only letters and spaces are allowed" disabled required></td>
								
								<td><input  class="input-field" name="newocfName"
								style="text-align: center; font-size: large; width: 100%; height: 4lvh; margin-bottom: 5px; margin-top: 5px;"
								pattern="[A-Za-z\s]+" title="Only letters and spaces are allowed"  disabled required></td>
							
<!-- 							<input type="hidden" name="regno" -->
<!-- 								th:value="${item.getRegno()}"> -->
<!-- 								 <input type="hidden" -->
<!-- 								name="sjointoccupant" th:value="${item.getSjointoccupant()}"> -->
								<input type="hidden" name="cr_vcode"
								th:value="${item. getCr_vcode()}"> 
<!-- 								<input type="hidden" -->
<!-- 								name="data_src" th:value="${item.getData_src()}">  -->
								<input
								type="hidden" id="cr_year" name="cr_year"
								th:value="${item. getCropyear }"> 
								<input type="hidden"
								name="cr_season" th:value="${item. getCr_season()}">
								
						
								
								<td><input name="recID" id="recID" style="display: none;" th:value="${item.getRec_id}"></td>
								<td><input name="bookingid" id="bookingid" style="display: none;" th:value="${item.getBookingid}"></td>
								
						

								
								
						</tr>
						<tr>
		<h3 th:text="${empty}" th:value="${empty}"
							style="text-align: center;"></h3></tr>

					</tbody>

					<tfoot>
						<tr>
						
					
							<td style="padding-left: 45%;"><input type="submit"
								class="btn btn-primary" value="Submit"></td>
							<td style="padding-left: 55%;"><input type="button"
								class="btn btn-primary" value="Go Back" onclick="goBack()"></td>
						</tr>
					</tfoot>
					
				</table>
			</div>

		</div>
	</form>
	<script>



		function mod(num, divisor) {
			//alert('in mod');
			return ((num % divisor) + divisor) % divisor;
		}

		function validateVerhoeff(num) {

			var d = [
				[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
				[1, 2, 3, 4, 0, 6, 7, 8, 9, 5],
				[2, 3, 4, 0, 1, 7, 8, 9, 5, 6],
				[3, 4, 0, 1, 2, 8, 9, 5, 6, 7],
				[4, 0, 1, 2, 3, 9, 5, 6, 7, 8],
				[5, 9, 8, 7, 6, 0, 4, 3, 2, 1],
				[6, 5, 9, 8, 7, 1, 0, 4, 3, 2],
				[7, 6, 5, 9, 8, 2, 1, 0, 4, 3],
				[8, 7, 6, 5, 9, 3, 2, 1, 0, 4],
				[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
			];

			// permutation table p
			var p = [
				[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
				[1, 5, 7, 6, 2, 8, 3, 0, 9, 4],
				[5, 8, 0, 3, 7, 9, 6, 1, 4, 2],
				[8, 9, 1, 6, 0, 4, 3, 5, 2, 7],
				[9, 4, 5, 3, 1, 2, 6, 8, 7, 0],
				[4, 2, 8, 6, 5, 7, 3, 9, 0, 1],
				[2, 7, 9, 3, 8, 0, 6, 4, 1, 5],
				[7, 0, 4, 6, 9, 1, 3, 2, 5, 8]
			];

			var c = 0;
			var myArray = [];
			myArray = StringToReversedIntArray(num);
			// alert(myArray);
			for (var i = 0; i < myArray.length; i++) {
				c = d[c][p[mod(i, 8)][myArray[i]]];
				//	alert(c);
			}

			return (c == 0);
		}
		function StringToReversedIntArray(num) {
			var myArray = [];

			for (var i = 0; i < num.length; i++) {
				myArray[i] = parseInt(num.substring(i, i + 1));
			}
			myArray = Reverse(myArray);

			return myArray;

		}
		function Reverse(myArray) {
			var reversed = [];

			for (var i = 0; i < myArray.length; i++) {
				reversed[i] = myArray[myArray.length - (i + 1)];
			}
			return reversed;
		}



		function goBack() {
			window.location.href = './wrongaadhaarRBKCCRC';
			window.history.back();
		}



		document.getElementById('main').addEventListener('change', function () {

			var checkboxes = document.querySelectorAll('.sub-checkbox');
			checkboxes.forEach(function (checkbox) {
				checkbox.checked = document.getElementById('main').checked;

				updateInputState(checkbox);

			});

		});

		var checkboxes = document.querySelectorAll('.sub-checkbox');
		checkboxes.forEach(function (checkbox) {
			checkbox.addEventListener('change', function () {
				updateInputState(checkbox);
			});
		});

		var inputFields = document.querySelectorAll('.input-field');
		inputFields.forEach(function (input) {
			input.addEventListener('input', function () {
				
			});
		});

		function updateInputState(checkbox) {
    var row = checkbox.closest('tr');  // Get the closest row (<tr>) containing the checkbox
    var inputBox = row.querySelector('.input-field');  // The input field for Aadhaar
    var newocNameInput = row.querySelector('[name="newocName"]');  // Input field for newocName
    var newocfNameInput = row.querySelector('[name="newocfName"]');  // Input field for newocfName

    
    inputBox.disabled = !checkbox.checked;
    newocNameInput.disabled = !checkbox.checked;
    newocfNameInput.disabled = !checkbox.checked;
}
		function validateForm() {
			let checkboxes = document.querySelectorAll('.sub-checkbox:checked');
			let records = document.querySelectorAll('.sub-checkbox');

			if (records.length === 0 && checkboxes.length === 0) {
				alert('No data to submit');
				goBack();
// 				window.location.href = '/aadhaarSearch';
			}
			if (records.length > 0 && checkboxes.length === 0) {

				alert('Please check at least one checkbox');
				return false;
			}
			else {
				let uidNo = null;

				checkboxes.forEach(function (checkbox) {
					if (checkbox.checked) {
						uidNo = checkbox.closest('tr').querySelector('[name="aadhaar"]').value.trim();
						
					}
				});
				if (uidNo.length === 12) {
					if (validateVerhoeff(uidNo) && uidNo != '123456789012' && uidNo !=  '012345678901' && uidNo !=  '111111111111' && uidNo !=  '222222222222' &&
      '333333333333' && uidNo !=  '444444444444' && uidNo !=  '555555555555' && uidNo !=  '666666666666' &&
      '777777777777' && uidNo != '888888888888' && uidNo !=  '999999999999' && uidNo !=  '000000000000' && uidNo !=  '123123123123') {
						validation();
						alert('Data Updated Successfully')
// 						window.location.href = '/aadhaarSearch';
						 //   history.go(-1);

					}
					else  {
						alert('Enter valid AadhaarNo');
						return false;
					}
				}
				else {
					alert('Enter 12 digit AadhaarNo');
					return false;
				}
			}
		}
		function validation() {
			var uidNo = document.getElementById('aadhaar').value.trim();
		
			if (validateVerhoeff(uidNo)) {
				document.getElementById('updationForm');
				//.addEventListener('submit', function (event) {
				var formDataArray = [];
				goBack();
				document.querySelectorAll('tbody tr').forEach(function (row) {
					var checkbox = row.querySelector('.sub-checkbox');
					
					if (checkbox && checkbox.checked) {
						
						var oldAadhaar = row.querySelector('[name="oldaadhaar"]').value;
						var recID = row.querySelector('[name="recID"]').value;
						var bookingid = row.querySelector('[name="bookingid"]').value;
						
		                // Alert the old_aadhaar value
		             //   alert("Old Aadhaar Number: " + oldAadhaar);
		               
		                
						formDataArray.push({
							ocName: row.querySelector('[name="ocName"]').value,
							ocfName: row.querySelector('[name="ocfName"]').value,
							sNo: row.querySelector('[name="sNo"]').value,
							kh_no: row.querySelector('[name="khNo"]').value,							
							cr_vcode: row.querySelector('[name="cr_vcode"]').value,							
							cr_year: row.querySelector('[name="cr_year"]').value,
							cr_season: row.querySelector('[name="cr_season"]').value,
							aadhaar: row.querySelector('[name="aadhaar"]').value,
							newocName:row.querySelector('[name="newocName"]').value,
							newocfName:row.querySelector('[name="newocfName"]').value,							
							code:row.querySelector('[name="codee"]').value,							
							cType:row.querySelector('[name="cType"]').value,							
							old_aadhaar: oldAadhaar,
							rec_id: recID,
							bookingid:bookingid
							
						});
					}
					console.log('Inside forEach loop');
				});

				console.log(formDataArray);
				
				

				$.ajax({
				    url: './worngupdatedsRBKCCRC',
				    type: 'POST',
				    contentType: 'application/json;',
				    data: JSON.stringify(formDataArray),
				    success: function (data) {
				    	
			
				        console.log('Success:', data);
				        // Handle success response here
				    },
				    error: function (error) {
				        console.error('Error during fetch operation:', error);
				        // Handle error response here
				    }
				});
				console.log('After fetch');
				
			}
		}

	</script>
</body>

</html>